---
# Pipeline configuration for Next.js project with Vercel deployment
# Save this as .github/pipeline.yaml in your project

version: '2.0'

# Tech stack is auto-detected from package.json
# Optionally specify explicitly:
# stack: nodejs
# runtime:
#   node_version: "20"

pipeline:
  fail_fast: false
  enable_caching: true

security:
  enable: true
  trufflehog: true
  dependency_review: true
  fail_on_secrets: true
  fail_on_vulnerabilities: false

lint:
  enable: true
  # Uses npm run lint from package.json by default
  # Optionally specify custom command:
  # command: npm run lint:fix

test:
  enable: true
  # Uses npm test from package.json by default
  coverage: true
  # Optionally specify custom command:
  # command: npm run test:ci

build:
  enable: true
  # Uses npm run build from package.json by default
  upload_artifacts: false

deployment:
  provider: vercel

  vercel: {}
  # scope: your-team-slug  # Optional: Vercel team scope

  environments:
    - name: preview
      trigger:
        event: pull_request
      auto_deploy: true

    - name: staging
      trigger:
        event: push
        branch: dev
      auto_deploy: true

    - name: production
      trigger:
        event: push
        branch: main
      auto_deploy: true

release:
  enable: true
  type: node
  # package_name: my-app  # Optional: customize package name
  bump_minor_pre_major: true

# Note: After a release on main, version changes (package.json, CHANGELOG.md)
# are automatically synced back to dev to prevent version drift.
# This sync commit uses [skip ci] and won't appear in future release notes.
