---
# Pipeline configuration for Python project with DigitalOcean deployment
# Save this as .github/pipeline.yaml in your project

version: '2.0'

stack: python

runtime:
  python_version: '3.11'

pipeline:
  fail_fast: false
  enable_caching: true

security:
  enable: true
  trufflehog: true
  dependency_review: true
  fail_on_secrets: true

lint:
  enable: true
  # Auto-detects ruff, flake8, or pylint
  # Optionally specify custom command:
  # command: ruff check . && black --check .

test:
  enable: true
  # Auto-detects pytest or unittest
  coverage: true
  # Optionally specify custom command:
  # command: pytest --cov --cov-report=xml

build:
  enable: true
  # For Python, this runs poetry build or python setup.py build if applicable

deployment:
  provider: digitalocean

  digitalocean:
    app_name: my-python-api
    app_spec: .do/app.yaml
    print_logs: true

  environments:
    - name: preview
      trigger:
        event: pull_request
      auto_deploy: true

    - name: production
      trigger:
        event: push
        branch: main
      auto_deploy: true

release:
  enable: true
  type: python
  package_name: my-python-package
